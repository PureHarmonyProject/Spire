package spire_web_http.unittests.boundary

import std.unittest.*
import std.unittest.testmacro.*
import spire_web_http.*
import spire_web_http.unittests.*
import std.collection.*

/**
 * RouteValuesè¾¹ç•Œå€¼æµ‹è¯•
 * æµ‹è¯•RouteValuesçš„è¾¹ç•Œæ¡ä»¶å¤„ç†
 */
@Test
func RouteValuesè¾¹ç•Œå€¼æµ‹è¯•() {
    let routeValues = RouteValues()
    
    // æµ‹è¯•ç©ºé”®è¾¹ç•Œæ¡ä»¶
    routeValues.add("", "EmptyKeyValue")
    @Expect(routeValues.get(""), "EmptyKeyValue")
    @Expect(routeValues.contains(""))
    @Expect(!routeValues.isEmpty())
    
    // æµ‹è¯•ç‰¹æ®Šå­—ç¬¦é”®è¾¹ç•Œæ¡ä»¶
    routeValues.add("key with spaces", "space_value")
    routeValues.add("key-with-dashes", "dash_value")
    routeValues.add("key_with_underscores", "underscore_value")
    routeValues.add("key.with.dots", "dot_value")
    routeValues.add("key@with@symbols", "symbol_value")
    routeValues.add("key:with:colons", "colon_value")
    routeValues.add("key/with/slashes", "slash_value")
    
    // éªŒè¯ç‰¹æ®Šå­—ç¬¦é”®çš„è®¿é—®
    @Expect(routeValues.get("key with spaces"), "space_value")
    @Expect(routeValues.get("key-with-dashes"), "dash_value")
    @Expect(routeValues.get("key_with_underscores"), "underscore_value")
    @Expect(routeValues.get("key.with.dots"), "dot_value")
    @Expect(routeValues.get("key@with@symbols"), "symbol_value")
    @Expect(routeValues.get("key:with:colons"), "colon_value")
    @Expect(routeValues.get("key/with/slashes"), "slash_value")
    
    // éªŒè¯ä¸å­˜åœ¨çš„é”®
    @Expect(!routeValues.contains("nonexistent"))
    @Expect(!routeValues.contains(""))
}

/**
 * RouteValuesç©ºé”®å¤„ç†è¾¹ç•Œæµ‹è¯•
 * æµ‹è¯•ç©ºå­—ç¬¦ä¸²é”®çš„è¾¹ç•Œæ¡ä»¶å¤„ç†
 */
@Test
func RouteValuesç©ºé”®å¤„ç†è¾¹ç•Œæµ‹è¯•() {
    let routeValues = RouteValues()
    
    // æ·»åŠ ç©ºé”®
    routeValues.add("", "EmptyKeyValue")
    @Expect(routeValues.get(""), "EmptyKeyValue")
    @Expect(routeValues.contains(""))
    @Expect(!routeValues.isEmpty())
    
    // åˆ é™¤ç©ºé”®
    let removedValue = routeValues.remove("")
    @Expect(removedValue, "EmptyKeyValue")
    @Expect(!routeValues.contains(""))
    
    // éªŒè¯åˆ é™¤åçš„çŠ¶æ€
    @Expect(routeValues.isEmpty())
    @Expect(routeValues.size, 0)
}

/**
 * RouteValuesæ€§èƒ½è¾¹ç•Œæµ‹è¯•
 * æµ‹è¯•RouteValuesåœ¨å¤§é‡æ•°æ®ä¸‹çš„æ€§èƒ½è¡¨ç°
 */
@Test
func RouteValuesæ€§èƒ½è¾¹ç•Œæµ‹è¯•() {
    let routeValues = RouteValues()
    
    // æ·»åŠ å¤§é‡æ•°æ®
    routeValues.add("key_0", "value_0")
    routeValues.add("key_1", "value_1")
    routeValues.add("key_2", "value_2")
    routeValues.add("key_3", "value_3")
    routeValues.add("key_4", "value_4")
    routeValues.add("key_5", "value_5")
    routeValues.add("key_6", "value_6")
    routeValues.add("key_7", "value_7")
    routeValues.add("key_8", "value_8")
    routeValues.add("key_9", "value_9")
    
    // éªŒè¯æ•°æ®å®Œæ•´æ€§
    @Expect(routeValues.size, 10)
    @Expect(routeValues.get("key_0"), "value_0")
    @Expect(routeValues.get("key_9"), "value_9")
}

/**
 * RouteValueså†…å­˜è¾¹ç•Œæµ‹è¯•
 * æµ‹è¯•RouteValuesçš„å†…å­˜ä½¿ç”¨æƒ…å†µ
 */
@Test
func RouteValueså†…å­˜è¾¹ç•Œæµ‹è¯•() {
    let routeValues = RouteValues()
    
    // æ·»åŠ é•¿å­—ç¬¦ä¸²æ•°æ®
    let longKey = "very_long_key_name_with_additional_padding_to_test_memory_usage"
    let longValue = "very_long_value_with_additional_padding_to_test_memory_usage_and_boundary_conditions"
    routeValues.add(longKey, longValue)
    
    // éªŒè¯å†…å­˜ä½¿ç”¨åˆç†ï¼ˆä¸æŠ›å‡ºå†…å­˜ä¸è¶³å¼‚å¸¸ï¼‰
    @Expect(routeValues.size, 1)
    @Expect(routeValues.get(longKey), longValue)
}

/**
 * RouteValuesUnicodeè¾¹ç•Œæµ‹è¯•
 * æµ‹è¯•Unicodeå­—ç¬¦çš„å¤„ç†
 */
@Test
func RouteValuesUnicodeè¾¹ç•Œæµ‹è¯•() {
    let routeValues = RouteValues()
    
    // æ·»åŠ Unicodeé”®å€¼å¯¹
    routeValues.add("ä¸­æ–‡é”®", "ä¸­æ–‡å€¼")
    routeValues.add("ã‚­ãƒ¼", "å€¤")
    routeValues.add("ĞºĞ»ÑÑ‡", "Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ")
    routeValues.add("key_with_ä¸­æ–‡", "value_with_ä¸­æ–‡")
    routeValues.add("ğŸš€", "rocket")
    routeValues.add("æµ‹è¯•_ğŸŒŸ", "star_test")
    
    // éªŒè¯Unicodeå­—ç¬¦çš„è®¿é—®
    @Expect(routeValues.get("ä¸­æ–‡é”®"), "ä¸­æ–‡å€¼")
    @Expect(routeValues.get("ã‚­ãƒ¼"), "å€¤")
    @Expect(routeValues.get("ĞºĞ»ÑÑ‡"), "Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ")
    @Expect(routeValues.get("key_with_ä¸­æ–‡"), "value_with_ä¸­æ–‡")
    @Expect(routeValues.get("ğŸš€"), "rocket")
    @Expect(routeValues.get("æµ‹è¯•_ğŸŒŸ"), "star_test")
    
    // éªŒè¯å¤§å°
    @Expect(routeValues.size, 6)
}

/**
 * RouteValuesé›†åˆæ“ä½œè¾¹ç•Œæµ‹è¯•
 * æµ‹è¯•é›†åˆæ“ä½œåœ¨è¾¹ç•Œæ¡ä»¶ä¸‹çš„è¡Œä¸º
 */
@Test
func RouteValuesé›†åˆæ“ä½œè¾¹ç•Œæµ‹è¯•() {
    let routeValues = RouteValues()
    
    // æµ‹è¯•ç©ºé›†åˆæ“ä½œ
    @Expect(routeValues.isEmpty())
    @Expect(routeValues.size, 0)
    
    // æ·»åŠ å•ä¸ªå…ƒç´ 
    routeValues.add("single", "value")
    @Expect(!routeValues.isEmpty())
    @Expect(routeValues.size, 1)
    
    // æ¸…ç©ºé›†åˆ
    routeValues.clear()
    @Expect(routeValues.isEmpty())
    @Expect(routeValues.size, 0)
    
    // æµ‹è¯•é‡å¤æ·»åŠ ç›¸åŒé”®
    routeValues.add("duplicate", "value1")
    routeValues.add("duplicate", "value2")
    @Expect(routeValues.size, 1)
    @Expect(routeValues.get("duplicate"), "value2")
    
    // æµ‹è¯•åˆ é™¤ä¸å­˜åœ¨çš„é”®
    let result = routeValues.remove("nonexistent")
    @Expect(routeValues.size, 1)
}

/**
 * RouteValuesè¿­ä»£è¾¹ç•Œæµ‹è¯•
 * æµ‹è¯•è¿­ä»£å™¨åœ¨è¾¹ç•Œæ¡ä»¶ä¸‹çš„è¡Œä¸º
 */
@Test
func RouteValuesè¿­ä»£è¾¹ç•Œæµ‹è¯•() {
    let routeValues = RouteValues()
    
    // æµ‹è¯•ç©ºé›†åˆè¿­ä»£
    var emptyCount = 0
    for ((key, value) in routeValues) {
        emptyCount++
    }
    @Expect(emptyCount, 0)
    
    // æµ‹è¯•å•å…ƒç´ è¿­ä»£
    routeValues.add("single", "value")
    var singleCount = 0
    for ((key, value) in routeValues) {
        singleCount++
        @Expect(key, "single")
        @Expect(value, "value")
    }
    @Expect(singleCount, 1)
    
    // æµ‹è¯•å¤šå…ƒç´ è¿­ä»£
    routeValues.clear()
    routeValues.add("key_0", "value_0")
    routeValues.add("key_1", "value_1")
    routeValues.add("key_2", "value_2")
    
    var totalCount = 0
    for ((key, value) in routeValues) {
        totalCount++
    }
    @Expect(totalCount, 3)
}